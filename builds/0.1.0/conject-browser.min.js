/* conject 0.1.0 | (c) Fabio Mereu | MIT license | https://github.com/medenagan/conject | 2019-01-10T00:24+01:00 */
!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).conject=f()}}(function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){(function(process){"use strict";function _construct(Parent,args,Class){return(_construct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(Parent,args,Class){var a=[null];a.push.apply(a,args);var instance=new(Function.bind.apply(Parent,a));return Class&&_setPrototypeOf(instance,Class.prototype),instance}).apply(null,arguments)}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _=new WeakMap,now="object"===(void 0===process?"undefined":_typeof(process))&&"function"==typeof process.hrtime?function(a,b){var _process$hrtime2;return 1e3*(_process$hrtime2=_slicedToArray(process.hrtime(),2))[0]+1e-6*_process$hrtime2[1]}:"object"===("undefined"==typeof performance?"undefined":_typeof(performance))&&"function"==typeof performance.now?performance.now.bind(performance):Date.now,DisposableMegaphone=function(){function DisposableMegaphone(){_classCallCheck(this,DisposableMegaphone),_.set(this,{callbacks:[]})}return _createClass(DisposableMegaphone,[{key:"speak",value:function(){for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++)params[_key]=arguments[_key];var self=_.get(this);if(self.used)throw new Error(this.constructor.name+".speak() must be called only once. Cannot accept "+String(params)+" after "+String(self.params));self.used=!0,self.params=params,self.callbacks.forEach(function(callback){return callback.apply(null,params)}),self.callbacks=null}},{key:"listen",value:function(callback){if("function"!=typeof callback)throw new Error(this.constructor.name+".listen requires a function as callback");var _$get=_.get(this),used=_$get.used,params=_$get.params,callbacks=_$get.callbacks;used?callback.apply(null,params):callbacks.push(callback)}}]),DisposableMegaphone}(),EVALUATION_REJECT=function(reason){var self=_.get(this);self.done?console.warn("Resolver function attempted to call onRejected after status was already set, ignored"):(self.done=!0,self.reason=reason,self.status="rejected",self.queue.speak(function(resolve,reject){return reject(reason)}))},Evaluation=function(){function Evaluation(resolver){var aborter=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){};if(_classCallCheck(this,Evaluation),"function"!=typeof resolver)throw new Error(this.constructor.name+" resolver "+String(resolver)+" is not a function");if("function"!=typeof aborter)throw new Error(this.constructor.name+" aborter "+String(aborter)+" is not a function");_.set(this,{resolver:resolver,aborter:aborter,done:!1,status:"pending",queue:new DisposableMegaphone})}return _createClass(Evaluation,null,[{key:"resolve",value:function(value){return new Evaluation(function(resolve){return resolve(value)})}},{key:"reject",value:function(reason){return new Evaluation(function(_,reject){return reject(reason)})}}]),_createClass(Evaluation,[{key:"abort",value:function(){var reason=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"aborted",_$get2=_.get(this),status=_$get2.status,aborter=_$get2.aborter;if("ongoing"!==status)return"pending"===status&&(EVALUATION_REJECT.call(this,reason),!0);EVALUATION_REJECT.call(this,reason);try{aborter.call(null)}catch(e){console.warn(this.constructor.name+".abort()",e)}return!0}},{key:"on",value:function(onFulfilled,onRejected){"function"==typeof onFulfilled||(onFulfilled=function(x){return x}),"function"==typeof onRejected||(onRejected=function(e){throw e});var self=_.get(this);if("pending"===self.status){self.status="ongoing";try{self.resolver.call(null,function(value){var self=_.get(this);self.done?console.warn("Resolver function attempted to call onFulfilled after status was already set, ignored"):(self.done=!0,self.value=value,self.status="resolved",self.queue.speak(function(resolve,reject){return resolve(value)}))}.bind(this),EVALUATION_REJECT.bind(this))}catch(reason){EVALUATION_REJECT.call(this,reason)}finally{self.async=!self.done}}"resolved"===self.status?onFulfilled.call(null,self.value):"rejected"===self.status?onRejected.call(null,self.reason):"ongoing"===self.status&&self.queue.listen(function(fn){return fn(onFulfilled,onRejected)})}},{key:"ona",value:function(onFulfilled,onRejected){var _this=this;Promise.resolve().then(function(_){_this.on(onFulfilled,onRejected)})}},{key:"toString",value:function(){var _$get3=_.get(this),status=_$get3.status,reason=_$get3.reason,value=_$get3.value,info="resolved"===status?value:"rejected"===status?reason:"";return"<".concat(status,">").concat(info)}},{key:"toPromise",value:function(){return new Promise(this.on.bind(this))}},{key:"then",value:function(onFulfilled,onRejected){return this.toPromise().then(onFulfilled,onRejected)}},{key:"status",get:function(){return _.get(this).status}},{key:"async",get:function(){var _$get4=_.get(this),status=_$get4.status,async=_$get4.async;if("pending"===status)throw new Error(".async does not exist for ["+status+"] status");return!!async}},{key:"value",get:function(){var _$get5=_.get(this),status=_$get5.status,value=_$get5.value;if("resolved"!==status)throw new Error(".value does not exist for ["+status+"] status");return value}},{key:"reason",get:function(){var _$get6=_.get(this),status=_$get6.status,reason=_$get6.reason;if("rejected"!==status)throw new Error(".reason does not exist for ["+status+"] status");return reason}},{key:Symbol.toStringTag,get:function(){return this.toString()}}]),Evaluation}(),Condition=function(){function Condition(){var members=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,Condition),_.set(this,Object.assign({},members))}return _createClass(Condition,[{key:"test",value:function(){return Evaluation.reject(new Error(this.constructor.name+".test() must be implemented on a derived class"))}},{key:"toPromise",value:function(initialValue){var _this2=this;return new Promise(function(resolve,reject){return _this2.test(initialValue).on(resolve,reject)})}}]),Condition}(),StaticCondition=function(_Condition){function StaticCondition(value){return _classCallCheck(this,StaticCondition),_possibleConstructorReturn(this,_getPrototypeOf(StaticCondition).call(this,{value:value}))}return _inherits(StaticCondition,Condition),_createClass(StaticCondition,[{key:"test",value:function(){return Evaluation.resolve(_.get(this).value)}},{key:"toString",value:function(){var value=_.get(this).value;return"string"==typeof value?'("'.concat(value,'")'):"(".concat(String(value),")")}},{key:"value",get:function(){return _.get(this).value}}]),StaticCondition}(),TrueCondition=function(_StaticCondition){function TrueCondition(){var _this3;return _classCallCheck(this,TrueCondition),_.has(TrueCondition)?_possibleConstructorReturn(_this3,_.get(TrueCondition)):(_this3=_possibleConstructorReturn(this,_getPrototypeOf(TrueCondition).call(this,!0)),_.set(TrueCondition,_assertThisInitialized(_assertThisInitialized(_this3))),_this3)}return _inherits(TrueCondition,StaticCondition),TrueCondition}(),FalseCondition=function(_StaticCondition2){function FalseCondition(){var _this4;return _classCallCheck(this,FalseCondition),_.has(FalseCondition)?_possibleConstructorReturn(_this4,_.get(FalseCondition)):(_this4=_possibleConstructorReturn(this,_getPrototypeOf(FalseCondition).call(this,!1)),_.set(FalseCondition,_assertThisInitialized(_assertThisInitialized(_this4))),_this4)}return _inherits(FalseCondition,StaticCondition),FalseCondition}(),TRUE=new TrueCondition,FALSE=new FalseCondition,ErrorCondition=function(_Condition2){function ErrorCondition(reason){return _classCallCheck(this,ErrorCondition),_possibleConstructorReturn(this,_getPrototypeOf(ErrorCondition).call(this,{reason:reason}))}return _inherits(ErrorCondition,Condition),_createClass(ErrorCondition,[{key:"test",value:function(){return Evaluation.reject(_.get(this).reason)}},{key:"toString",value:function(){return"(throw "+String(_.get(this).reason)+")"}},{key:"reason",get:function(){return _.get(this).reason}}]),ErrorCondition}(),EternalCondition=function(_Condition3){function EternalCondition(){return _classCallCheck(this,EternalCondition),_possibleConstructorReturn(this,_getPrototypeOf(EternalCondition).apply(this,arguments))}return _inherits(EternalCondition,Condition),_createClass(EternalCondition,[{key:"test",value:function(){return new Evaluation(function(){})}},{key:"toString",value:function(){return"(∞)"}}]),EternalCondition}(),FunctionalCondition=function(_Condition4){function FunctionalCondition(fn){var _this5;if(_classCallCheck(this,FunctionalCondition),_this5=_possibleConstructorReturn(this,_getPrototypeOf(FunctionalCondition).call(this,{fn:fn})),"function"!=typeof fn)throw new Error(_this5.constructor.name+" must be constructed from a function");return _this5}return _inherits(FunctionalCondition,Condition),_createClass(FunctionalCondition,[{key:"test",value:function(initialValue,scope){var fn=_.get(this).fn;return new Evaluation(function(resolve,reject){try{var result=fn.call(null,initialValue);isChainable(result)?result.condition.test(initialValue,scope).on(resolve,reject):result instanceof Condition?result.test(initialValue,scope).on(resolve,reject):result instanceof Promise?new PromiseCondition(result).test(initialValue,scope).on(resolve,reject):resolve(result)}catch(e){reject(e)}})}},{key:"toString",value:function(){var fn=_.get(this).fn;return"ƒ("+String(fn)+")"}},{key:"fn",get:function(){return _.get(this).fn}}]),FunctionalCondition}(),PromiseCondition=function(_Condition5){function PromiseCondition(promise){var _this6;if(_classCallCheck(this,PromiseCondition),_this6=_possibleConstructorReturn(this,_getPrototypeOf(PromiseCondition).call(this,{promise:promise})),!(promise instanceof Promise))throw new Error(_this6.constructor.name+" must be constructed from a Promise");return _this6}return _inherits(PromiseCondition,Condition),_createClass(PromiseCondition,[{key:"test",value:function(){var _this7=this;return new Evaluation(function(resolve,reject){return _.get(_this7).promise.then(resolve,reject)})}},{key:"toString",value:function(){return"("+String(_.get(this).promise)+")"}},{key:"promise",get:function(){return _.get(this).promise}}]),PromiseCondition}(),ConditionList=function(_Condition6){function ConditionList(){for(var _this8,_len2=arguments.length,conditions=new Array(_len2),_key2=0;_key2<_len2;_key2++)conditions[_key2]=arguments[_key2];if(_classCallCheck(this,ConditionList),_this8=_possibleConstructorReturn(this,_getPrototypeOf(ConditionList).call(this,{conditions:conditions})),conditions.some(function(condition){return!(condition instanceof Condition)}))throw new Error(_this8.constructor.name+" must be constructed from Condition objects only");if(conditions.length<2)throw new Error(_this8.constructor.name+" must be constructed from at least two Condition objects");return _this8}return _inherits(ConditionList,Condition),_createClass(ConditionList,[{key:"toString",value:function(){return"["+_.get(this).conditions.map(String).join()+"]"}},{key:"conditions",get:function(){return _.get(this).conditions.slice()}},{key:"length",get:function(){return _.get(this).conditions.length}}]),ConditionList}(),Sequential=function(operator){return function(_ConditionList){function _class(){return _classCallCheck(this,_class),_possibleConstructorReturn(this,_getPrototypeOf(_class).apply(this,arguments))}return _inherits(_class,ConditionList),_createClass(_class,[{key:"test",value:function(initialValue){var aborted,subEvaluation,conditions=_.get(this).conditions;return new Evaluation(function(resolve,reject){var result;!function testOne(){var index=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;aborted||(index>=conditions.length?resolve(result):(subEvaluation=conditions[index].test(index?result:initialValue)).on(function(value){var ref={value:value,isFirst:!index,isLast:index+1>=conditions.length,result:result,shouldBreak:!1};try{operator.call(null,ref),result=ref.result}catch(reason){return void reject(reason)}testOne(ref.shouldBreak?1/0:++index)},reject))}(0)},function(){aborted=!0,subEvaluation&&subEvaluation.abort()})}},{key:"toString",value:function(){return"["+_.get(this).conditions.map(String).join(operator.name)+"]"}}]),_class}()},Parallel=function(operator){return function(_ConditionList2){function _class2(){return _classCallCheck(this,_class2),_possibleConstructorReturn(this,_getPrototypeOf(_class2).apply(this,arguments))}return _inherits(_class2,ConditionList),_createClass(_class2,[{key:"test",value:function(){for(var _len3=arguments.length,params=new Array(_len3),_key3=0;_key3<_len3;_key3++)params[_key3]=arguments[_key3];var aborted,subEvaluations,conditions=_.get(this).conditions,length=conditions.length;return new Evaluation(function(resolve,reject){var result,done,executed=0,shouldReject=function(reason){done||aborted||(reject(reason),done=!0)},onResolvedOne=function(value){var isFirst=!executed,isLast=++executed>=length,ref={value:value,isFirst:isFirst,isLast:isLast,result:result,shouldBreak:!1};try{operator.call(null,ref),result=ref.result,(ref.shouldBreak||isLast)&&(done||aborted||(resolve(result),done=!0))}catch(reason){shouldReject(reason)}};subEvaluations=conditions.map(function(condition){var subEvaluation=condition.test.apply(condition,params);return subEvaluation.ona(onResolvedOne,shouldReject),subEvaluation})},function(){aborted=!0,subEvaluations&&subEvaluations.forEach(function(subEvaluation){return subEvaluation.abort()})})}},{key:"toString",value:function(){return"["+_.get(this).conditions.map(String).join("⋕"+operator.name+"⋕")+"]"}}]),_class2}()},OR=function(r){r.result=r.result||r.value,r.shouldBreak=r.result},AND=function(r){r.result=r.isFirst?r.value:r.result&&r.value,r.shouldBreak=!r.result},NOR=function(r){r.result=r.isFirst?!r.value:r.result&&!r.value,r.shouldBreak=r.value},NAND=function(r){r.result=r.result||!r.value,r.shouldBreak=r.result},XOR=function(r){r.result=r.isFirst?r.value:!r.result&&r.value||!r.value&&r.result},XNOR=function(r){r.result=r.isFirst?r.value:!r.result&&!r.value||r.result&&r.value},LINK=function(r){r.result=r.value},SequentialOr=function(_Sequential){function SequentialOr(){return _classCallCheck(this,SequentialOr),_possibleConstructorReturn(this,_getPrototypeOf(SequentialOr).apply(this,arguments))}return _inherits(SequentialOr,Sequential(OR)),SequentialOr}(),SequentialAnd=function(_Sequential2){function SequentialAnd(){return _classCallCheck(this,SequentialAnd),_possibleConstructorReturn(this,_getPrototypeOf(SequentialAnd).apply(this,arguments))}return _inherits(SequentialAnd,Sequential(AND)),SequentialAnd}(),SequentialNor=function(_Sequential3){function SequentialNor(){return _classCallCheck(this,SequentialNor),_possibleConstructorReturn(this,_getPrototypeOf(SequentialNor).apply(this,arguments))}return _inherits(SequentialNor,Sequential(NOR)),SequentialNor}(),SequentialNand=function(_Sequential4){function SequentialNand(){return _classCallCheck(this,SequentialNand),_possibleConstructorReturn(this,_getPrototypeOf(SequentialNand).apply(this,arguments))}return _inherits(SequentialNand,Sequential(NAND)),SequentialNand}(),SequentialXor=function(_Sequential5){function SequentialXor(){return _classCallCheck(this,SequentialXor),_possibleConstructorReturn(this,_getPrototypeOf(SequentialXor).apply(this,arguments))}return _inherits(SequentialXor,Sequential(XOR)),SequentialXor}(),SequentialXnor=function(_Sequential6){function SequentialXnor(){return _classCallCheck(this,SequentialXnor),_possibleConstructorReturn(this,_getPrototypeOf(SequentialXnor).apply(this,arguments))}return _inherits(SequentialXnor,Sequential(XNOR)),SequentialXnor}(),SequentialLink=function(_Sequential7){function SequentialLink(){return _classCallCheck(this,SequentialLink),_possibleConstructorReturn(this,_getPrototypeOf(SequentialLink).apply(this,arguments))}return _inherits(SequentialLink,Sequential(LINK)),SequentialLink}(),ParallelOr=function(_Parallel){function ParallelOr(){return _classCallCheck(this,ParallelOr),_possibleConstructorReturn(this,_getPrototypeOf(ParallelOr).apply(this,arguments))}return _inherits(ParallelOr,Parallel(OR)),ParallelOr}(),ParallelAnd=function(_Parallel2){function ParallelAnd(){return _classCallCheck(this,ParallelAnd),_possibleConstructorReturn(this,_getPrototypeOf(ParallelAnd).apply(this,arguments))}return _inherits(ParallelAnd,Parallel(AND)),ParallelAnd}(),ParallelNor=function(_Parallel3){function ParallelNor(){return _classCallCheck(this,ParallelNor),_possibleConstructorReturn(this,_getPrototypeOf(ParallelNor).apply(this,arguments))}return _inherits(ParallelNor,Parallel(NOR)),ParallelNor}(),ParallelNand=function(_Parallel4){function ParallelNand(){return _classCallCheck(this,ParallelNand),_possibleConstructorReturn(this,_getPrototypeOf(ParallelNand).apply(this,arguments))}return _inherits(ParallelNand,Parallel(NAND)),ParallelNand}(),ParallelXor=function(_Parallel5){function ParallelXor(){return _classCallCheck(this,ParallelXor),_possibleConstructorReturn(this,_getPrototypeOf(ParallelXor).apply(this,arguments))}return _inherits(ParallelXor,Parallel(XOR)),ParallelXor}(),ParallelXnor=function(_Parallel6){function ParallelXnor(){return _classCallCheck(this,ParallelXnor),_possibleConstructorReturn(this,_getPrototypeOf(ParallelXnor).apply(this,arguments))}return _inherits(ParallelXnor,Parallel(XNOR)),ParallelXnor}(),ParallelLink=function(_Parallel7){function ParallelLink(){return _classCallCheck(this,ParallelLink),_possibleConstructorReturn(this,_getPrototypeOf(ParallelLink).apply(this,arguments))}return _inherits(ParallelLink,Parallel(LINK)),ParallelLink}(),UnaryProxyCondition=function(_Condition7){function UnaryProxyCondition(source){var _this9,members=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,UnaryProxyCondition),_this9=_possibleConstructorReturn(this,_getPrototypeOf(UnaryProxyCondition).call(this,Object.assign({},members,{source:source}))),!(source instanceof Condition))throw new Error(_this9.constructor.name+" must be constructed from a Condition object");return _this9}return _inherits(UnaryProxyCondition,Condition),_createClass(UnaryProxyCondition,[{key:"toString",value:function(){return"(Proxy: "+_.get(this).source.toString()+")"}},{key:"source",get:function(){return _.get(this).source}}]),UnaryProxyCondition}(),DelayedCondition=function(_UnaryProxyCondition){function DelayedCondition(source){var _this10,delay=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(_classCallCheck(this,DelayedCondition),_this10=_possibleConstructorReturn(this,_getPrototypeOf(DelayedCondition).call(this,source)),delay=+delay,Number.isNaN(delay))throw new Error(_this10.constructor.name+"(..., delay) requires a numeric value or it can be omitted");return delay<0&&(delay=0),1e17<delay?_possibleConstructorReturn(_this10,new EternalCondition):(_.get(_assertThisInitialized(_assertThisInitialized(_this10))).delay=delay,_this10)}return _inherits(DelayedCondition,UnaryProxyCondition),_createClass(DelayedCondition,[{key:"test",value:function(){for(var _len4=arguments.length,params=new Array(_len4),_key4=0;_key4<_len4;_key4++)params[_key4]=arguments[_key4];var handle,subEvaluation,_$get12=_.get(this),source=_$get12.source,delay=_$get12.delay;return new Evaluation(function(resolve,reject){return handle=setTimeout(function(){handle=null,(subEvaluation=source.test.apply(source,params)).on(resolve,reject)},delay)},function(){handle&&(clearTimeout(handle),handle=null),subEvaluation&&subEvaluation.abort()})}},{key:"toString",value:function(){var _$get13=_.get(this),source=_$get13.source,delay=_$get13.delay;return"{".concat(delay,"ms↗").concat(source.toString(),"}")}},{key:"delay",get:function(){return _.get(this).delay}}]),DelayedCondition}(),DurableCondition=function(_UnaryProxyCondition2){function DurableCondition(source){var _this11,duration=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(_classCallCheck(this,DurableCondition),_this11=_possibleConstructorReturn(this,_getPrototypeOf(DurableCondition).call(this,source)),duration=+duration,Number.isNaN(duration))throw new Error(_this11.constructor.name+" expects a numeric duration or it can be omitted");return duration<0?_possibleConstructorReturn(_this11,FALSE):duration?(1e17<duration&&(duration=1/0),_.get(_assertThisInitialized(_assertThisInitialized(_this11))).duration=duration,_this11):_possibleConstructorReturn(_this11,source)}return _inherits(DurableCondition,UnaryProxyCondition),_createClass(DurableCondition,[{key:"test",value:function(){for(var _len5=arguments.length,params=new Array(_len5),_key5=0;_key5<_len5;_key5++)params[_key5]=arguments[_key5];var aborted,subEvaluation,_$get14=_.get(this),source=_$get14.source,duration=_$get14.duration,t0=now();return new Evaluation(function(resolve,reject){!function attempt(){(subEvaluation=source.test.apply(source,params)).on(function(value){aborted||(!value||now()-t0>=duration?resolve(value):setTimeout(attempt,0))},reject)}()},function(){aborted=!0,subEvaluation&&subEvaluation.abort()})}},{key:"toString",value:function(){return _.get(this).source.toString()}},{key:"duration",get:function(){return _.get(this).duration}}]),DurableCondition}(),TimeoutCondition=function(_UnaryProxyCondition3){function TimeoutCondition(source){var _this12,duration=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0;if(_classCallCheck(this,TimeoutCondition),_this12=_possibleConstructorReturn(this,_getPrototypeOf(TimeoutCondition).call(this,source)),duration=+duration,Number.isNaN(duration))throw new Error(_this12.constructor.name+" expects a numeric duration or it can be omitted");return 1e17<duration?_possibleConstructorReturn(_this12,source):duration<=0?_possibleConstructorReturn(_this12,FALSE):(_.get(_assertThisInitialized(_assertThisInitialized(_this12))).duration=duration,_this12)}return _inherits(TimeoutCondition,UnaryProxyCondition),_createClass(TimeoutCondition,[{key:"test",value:function(){for(var _len6=arguments.length,params=new Array(_len6),_key6=0;_key6<_len6;_key6++)params[_key6]=arguments[_key6];var done,handle,subEvaluation,_$get15=_.get(this),source=_$get15.source,duration=_$get15.duration,clear=function(){handle&&(clearTimeout(handle),handle=null)};return new Evaluation(function(resolve,reject){var shouldResolve=function(value){done||(done=!0,clear(),resolve(value))};subEvaluation=source.test.apply(source,params),handle=setTimeout(function(){handle=null,shouldResolve(!1),subEvaluation.abort()},duration),subEvaluation.ona(shouldResolve,function(reason){done||(done=!0,clear(),reject(reason))})},function(){done=!0,clear(),subEvaluation&&subEvaluation.abort()})}},{key:"toString",value:function(){return _.get(this).source.toString()}},{key:"duration",get:function(){return _.get(this).duration}}]),TimeoutCondition}(),CycleCondition=function(_UnaryProxyCondition4){function CycleCondition(source){var _this13,attempts=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;if(_classCallCheck(this,CycleCondition),_this13=_possibleConstructorReturn(this,_getPrototypeOf(CycleCondition).call(this,source)),attempts=+attempts,Number.isNaN(attempts))throw new Error(_this13.constructor.name+" requires an integer for attempts or it can be omitted");return attempts<1?_possibleConstructorReturn(_this13,FALSE):(attempts=Math.floor(attempts),_.get(_assertThisInitialized(_assertThisInitialized(_this13))).attempts=attempts,_this13)}return _inherits(CycleCondition,UnaryProxyCondition),_createClass(CycleCondition,[{key:"test",value:function(){for(var _len7=arguments.length,params=new Array(_len7),_key7=0;_key7<_len7;_key7++)params[_key7]=arguments[_key7];var subEvaluation,aborted,_$get16=_.get(this),source=_$get16.source,countdown=_$get16.attempts;return new Evaluation(function(resolve,reject){!function attempt(){aborted||(subEvaluation=source.test.apply(source,params)).on(function(value){aborted||(value||--countdown<1?resolve(value):setTimeout(attempt,0))},reject)}()},function(){aborted=!0,subEvaluation&&subEvaluation.abort()})}},{key:"attempts",get:function(){return _.get(this).attempts}}]),CycleCondition}(),NegativeCondition=function(_UnaryProxyCondition5){function NegativeCondition(source){var _this14;return _classCallCheck(this,NegativeCondition),_this14=_possibleConstructorReturn(this,_getPrototypeOf(NegativeCondition).call(this,source)),source instanceof NegativeCondition?_possibleConstructorReturn(_this14,new BooleanCondition(source.source)):source instanceof BooleanCondition?_possibleConstructorReturn(_this14,new NegativeCondition(source.source)):_this14}return _inherits(NegativeCondition,UnaryProxyCondition),_createClass(NegativeCondition,[{key:"test",value:function(){for(var _len8=arguments.length,params=new Array(_len8),_key8=0;_key8<_len8;_key8++)params[_key8]=arguments[_key8];var subEvaluation,source=_.get(this).source;return new Evaluation(function(resolve,reject){(subEvaluation=source.test.apply(source,params)).on(function(result){return resolve(!result)},reject)},function(){return subEvaluation&&subEvaluation.abort()})}},{key:"toString",value:function(){return"!"+_.get(this).source.toString()}}]),NegativeCondition}(),BooleanCondition=function(_UnaryProxyCondition6){function BooleanCondition(source){var _this15;return _classCallCheck(this,BooleanCondition),_this15=_possibleConstructorReturn(this,_getPrototypeOf(BooleanCondition).call(this,source)),source instanceof BooleanCondition||source instanceof NegativeCondition?_possibleConstructorReturn(_this15,source):_this15}return _inherits(BooleanCondition,UnaryProxyCondition),_createClass(BooleanCondition,[{key:"test",value:function(){for(var _len9=arguments.length,params=new Array(_len9),_key9=0;_key9<_len9;_key9++)params[_key9]=arguments[_key9];var subEvaluation,source=_.get(this).source;return new Evaluation(function(resolve,reject){(subEvaluation=source.test.apply(source,params)).on(function(result){return resolve(!!result)},reject)},function(){return subEvaluation&&subEvaluation.abort()})}},{key:"toString",value:function(){return"Boolean"+_.get(this).source.toString()}}]),BooleanCondition}(),EventCondition=function(_UnaryProxyCondition7){function EventCondition(source,onResolve,onReject){var _this16;return _classCallCheck(this,EventCondition),_this16=_possibleConstructorReturn(this,_getPrototypeOf(EventCondition).call(this,source)),_.get(_assertThisInitialized(_assertThisInitialized(_this16))).onResolve="function"==typeof onResolve?onResolve:function(_){},_.get(_assertThisInitialized(_assertThisInitialized(_this16))).onReject="function"==typeof onReject?onReject:function(_){},_this16}return _inherits(EventCondition,UnaryProxyCondition),_createClass(EventCondition,[{key:"test",value:function(){for(var _len10=arguments.length,params=new Array(_len10),_key10=0;_key10<_len10;_key10++)params[_key10]=arguments[_key10];var subEvaluation,_$get19=_.get(this),source=_$get19.source,onResolve=_$get19.onResolve,onReject=_$get19.onReject;return new Evaluation(function(resolve,reject){(subEvaluation=source.test.apply(source,params)).on(function(value){onResolve.call(null,value),resolve(value)},function(reason){onReject.call(null,reason),reject(reason)})},function(){subEvaluation&&subEvaluation.abort()})}},{key:"toString",value:function(){return _.get(this).source.toString()}}]),EventCondition}(),TrueEventCondition=function(_EventCondition){function TrueEventCondition(source,handler){var _this17;_classCallCheck(this,TrueEventCondition);if(_this17=_possibleConstructorReturn(this,_getPrototypeOf(TrueEventCondition).call(this,source,function(value){return value&&handler.call(null,value)})),"function"!=typeof handler)throw new Error(_this17.constructor.name+" needs a function as handler");return _this17}return _inherits(TrueEventCondition,EventCondition),TrueEventCondition}(),FalseEventCondition=function(_EventCondition2){function FalseEventCondition(source,handler){var _this18;_classCallCheck(this,FalseEventCondition);if(_this18=_possibleConstructorReturn(this,_getPrototypeOf(FalseEventCondition).call(this,source,function(value){return value||handler.call(null,value)})),"function"!=typeof handler)throw new Error(_this18.constructor.name+" needs a function as handler");return _this18}return _inherits(FalseEventCondition,EventCondition),FalseEventCondition}(),ErrorEventCondition=function(_EventCondition3){function ErrorEventCondition(source,handler){var _this19;if(_classCallCheck(this,ErrorEventCondition),_this19=_possibleConstructorReturn(this,_getPrototypeOf(ErrorEventCondition).call(this,source,void 0,handler)),"function"!=typeof handler)throw new Error(_this19.constructor.name+" needs a function as handler");return _this19}return _inherits(ErrorEventCondition,EventCondition),ErrorEventCondition}(),CHAINABLE_PROTOTYPE={toString:function(){return"C"+_.get(this).chain.map(function(link){return".".concat(link.method.name,"(").concat(link.params.map(String).join(", "),")")}).join("")},get condition(){var chain=_.get(this).chain;return chain.length&&chain[chain.length-1].condition||FALSE},toPromise:function(initialValue){return this.condition.toPromise(initialValue)},run:function(initialValue){if(DEBUG_MODE)return this.debug(initialValue);var evaluation=this.condition.test(initialValue);return evaluation.on(),evaluation},debug:function(initialValue){var evaluation=this.condition.test(initialValue),handle="#"+ ++DEBUG_COUNTER;return console.log("".concat("[1m").concat("[37m").concat("[46m","TEST ").concat(handle," runs").concat("[0m").concat("[1m").concat("[36m"," C").concat(this.toString()).concat("[0m")),evaluation.on(function(value){var valueColor="".concat("[1m").concat(value?"[32m":"[33m");console.log("TEST ".concat(handle,": [").concat(valueColor).concat(!!value).concat("[0m","]").concat(valueColor),value,"".concat("[0m"))},function(reason){console.error("".concat("[1m").concat("[37m").concat("[41m","TEST ").concat(handle," rejects the evaluation,"),reason,"".concat("[0m"))}),evaluation.async?console.log("".concat("[2m").concat("[4m").concat("[33m","TEST ").concat(handle," is running asynchronously").concat("[0m")):console.log("".concat("[2m").concat("[36m","TEST ").concat(handle," has run synchronously").concat("[0m")),evaluation},get _chain(){return _.get(this).chain.map(function(link){return Object.assign({},link)})}},isChainable=function(what){return(what=_.get(what))&&"object"===_typeof(what)&&Array.isArray(what.chain)},Chainable=function Chainable(source){_classCallCheck(this,Chainable);var ChainableInstance=function ChainableInstance(){return ChainableInstance.run.apply(ChainableInstance,arguments)},chain=isChainable(source)?_.get(source).chain.slice():[];return _.set(ChainableInstance,{chain:chain}),function(dest,source){for(var key in source){var descriptor=Object.getOwnPropertyDescriptor(source,key);Object.defineProperty(dest,key,descriptor)}return dest}(ChainableInstance,CHAINABLE_PROTOTYPE)},matryoshkingMethods=[{starter:!0,name:"if",compile:function(root){if(1!=(arguments.length<=1?0:arguments.length-1))throw new Error(".if accepts only one Condition as parameter");if(root)throw new Error(".if can be used only as first method in the chain. Use .and, .or, ... instead");return fromAny(arguments.length<=1?void 0:arguments[1])}}].concat(_toConsumableArray([{starter:!0,name:"and",constructor:SequentialAnd},{starter:!0,name:"or",constructor:SequentialOr},{starter:!0,name:"xor",constructor:SequentialXor},{starter:!0,name:"nor",constructor:SequentialNor},{starter:!0,name:"nand",constructor:SequentialNand},{starter:!0,name:"xnor",constructor:SequentialXnor},{starter:!0,name:"anda",constructor:ParallelAnd},{starter:!0,name:"ora",constructor:ParallelOr},{starter:!0,name:"xora",constructor:ParallelXor},{starter:!0,name:"nora",constructor:ParallelNor},{starter:!0,name:"nanda",constructor:ParallelNand},{starter:!0,name:"xnora",constructor:ParallelXnor}].map(function(method){return Object.assign(method,{compile:function(root){for(var _len11=arguments.length,params=new Array(1<_len11?_len11-1:0),_key11=1;_key11<_len11;_key11++)params[_key11-1]=arguments[_key11];if(params.length-!root<1)throw new Error(".".concat(method.name,"() needs two or more Condition operands"));var parsed=params.map(fromAny);return root&&parsed.unshift(root),_construct(method.constructor,_toConsumableArray(parsed))}})})),_toConsumableArray([{name:"not",constructor:NegativeCondition},{name:"bool",constructor:BooleanCondition}].map(function(method){return Object.assign(method,{compile:function(root){if(!(arguments.length<=1)&&arguments.length-1)throw new Error(".".concat(method.name,"() doesn't need any parameter"));return new method.constructor(root)}})})),_toConsumableArray([{name:"in",constructor:DelayedCondition},{name:"out",constructor:TimeoutCondition},{name:"during",constructor:DurableCondition},{name:"atmost",constructor:CycleCondition}].map(function(method){return Object.assign(method,{compile:function(root){return new method.constructor(root,arguments.length<=1?void 0:arguments[1])}})})),[{name:"throw",starter:!0,compile:function(root){var error=new ErrorCondition(arguments.length<=1?void 0:arguments[1]);return root?new SequentialLink(root,error):error}}],_toConsumableArray([{name:"onTrue",constructor:TrueEventCondition,defaultHandler:console.log},{name:"onFalse",constructor:FalseEventCondition,defaultHandler:console.warn},{name:"onError",constructor:ErrorEventCondition,defaultHandler:console.error}].map(function(method){return Object.assign(method,{compile:function(root){for(var _method$defaultHandle,_len12=arguments.length,params=new Array(1<_len12?_len12-1:0),_key12=1;_key12<_len12;_key12++)params[_key12-1]=arguments[_key12];return new method.constructor(root,"function"==typeof params[0]?params[0]:(_method$defaultHandle=method.defaultHandler).bind.apply(_method$defaultHandle,[null].concat(params)))}})})));matryoshkingMethods.forEach(function(method){var name=method.name,compile=method.compile,starter=method.starter;CHAINABLE_PROTOTYPE[name]=function(){for(var _len13=arguments.length,params=new Array(_len13),_key13=0;_key13<_len13;_key13++)params[_key13]=arguments[_key13];var clone=new Chainable(this),chain=_.get(clone).chain,root=chain.length&&chain[chain.length-1].condition;if(!root&&!starter)throw new Error(".".concat(name,"() cannot be a first condition"));var condition=compile.apply(void 0,[root].concat(params));return chain.push({method:method,params:params,condition:condition}),clone}});var fromAny=function(any){return any instanceof Condition?any:isChainable(any)?any.condition:any instanceof Promise?new PromiseCondition(any):"function"==typeof any?new FunctionalCondition(any):new StaticCondition(any)},DEBUG_COUNTER=0,DEBUG_MODE=!0,C={Evaluation:Evaluation,Chainable:Chainable,get DEBUG(){return DEBUG_MODE},set DEBUG(value){DEBUG_MODE=!!value}};C.condition={StaticCondition:StaticCondition,TrueCondition:TrueCondition,FalseCondition:FalseCondition,FunctionalCondition:FunctionalCondition,PromiseCondition:PromiseCondition,ErrorCondition:ErrorCondition,EternalCondition:EternalCondition,SequentialAnd:SequentialAnd,SequentialOr:SequentialOr,SequentialXor:SequentialXor,SequentialNor:SequentialNor,SequentialNand:SequentialNand,SequentialXnor:SequentialXnor,SequentialLink:SequentialLink,ParallelAnd:ParallelAnd,ParallelOr:ParallelOr,ParallelXor:ParallelXor,ParallelNor:ParallelNor,ParallelNand:ParallelNand,ParallelXnor:ParallelXnor,ParallelLink:ParallelLink,NegativeCondition:NegativeCondition,DelayedCondition:DelayedCondition,CycleCondition:CycleCondition,DurableCondition:DurableCondition,TimeoutCondition:TimeoutCondition,EventCondition:EventCondition,TrueEventCondition:TrueEventCondition,FalseEventCondition:FalseEventCondition,ErrorEventCondition:ErrorEventCondition,fromValue:function(value){return new StaticCondition(value)},fromFunction:function(fn){return new FunctionalCondition(fn)},fromPromise:function(promise){return new PromiseCondition(promise)},fromAny:fromAny,TRUE:TRUE,FALSE:FALSE},matryoshkingMethods.filter(function(method){return method.starter}).forEach(function(method){return C[method.name]=function(){var _ref;return(_ref=new Chainable)[method.name].apply(_ref,arguments)}});var _default=C;exports.default=_default,module.exports=exports.default}).call(this,require("_process"))},{_process:2}],2:[function(require,module,exports){var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}]},{},[1])(1)});